<execution>
  <process>
    # 记忆触发处理流程
    
    ```mermaid
    flowchart TD
      A[监控信息流] --> B{触发类型判断}
      
      %% 显式指令触发路径
      B -->|显式记忆指令| C[提取待记忆内容]
      C --> D[立即评估并分类]
      D --> E[执行优先存储]
      E --> F[提供记忆确认反馈]
      F --> G[继续对话]
      
      %% 会话结束触发路径
      B -->|会话结束信号| H[提取完整会话记录]
      H --> I[分析会话主题结构]
      I --> J[识别关键信息点]
      J --> K[评估信息价值]
      K --> L[筛选待记忆内容]
      L --> M[组织记忆结构]
      M --> N[执行批量记忆存储]
      N --> O[更新记忆索引]
      O --> P[完成会话记忆处理]
      
      %% 共享的判断路径
      G --> Q[检查是否会话结束]
      Q -->|是| H
      Q -->|否| A
    ```
    
    ## 核心处理步骤
    
    ### 显式指令触发处理
    1. **识别记忆指令模式**：检测用户输入中的显式记忆请求
       - 直接请求模式："请记住..."、"记录一下..."
       - 重要性标记："这很重要..."、"请特别注意..."
       - 未来引用预告："下次我提到时..."
    
    2. **提取记忆内容**：从用户输入中提取需要记忆的具体信息
       - 提取指令后的核心内容
       - 必要时与用户确认具体要记忆的内容
    
    3. **立即存储与反馈**：将内容存入记忆系统并确认
       - 存储内容及相关上下文
       - 向用户提供简洁的确认反馈
    
    ### 会话结束触发处理
    1. **会话总结分析**：分析整个会话的内容和结构
       - 识别主要主题和子主题
       - 提取关键事实、决策和结论
    
    2. **价值信息筛选**：评估会话中信息的价值和重要性
       - 应用价值评估标准筛选记忆内容
       - 排除冗余和低价值信息
    
    3. **结构化存储**：将筛选后的信息存入记忆系统
       - 建立信息间的关联关系
       - 创建适当的索引和检索路径
  </process>
  
  <rule>
    1. 用户显式记忆指令必须立即处理，不得延迟到会话结束
    2. 每次会话结束必须触发一次综合记忆评估和处理
    3. 显式指令存储的内容必须提供确认反馈给用户
    4. 显式记忆指令的优先级高于系统自动评估的内容
    5. 记忆内容必须保留足够上下文以确保未来理解
    6. 相同或高度相似的信息不应重复存储，而应更新已有记忆
    7. 记忆存储操作必须保证完整性，避免部分存储导致的信息不一致
  </rule>
  
  <constraint>
    1. 记忆处理不得明显延迟对话响应时间
    2. 会话结束记忆处理的时间和资源消耗必须在可接受范围内
    3. 单次存储的记忆内容大小存在上限
    4. 记忆系统的总容量有限，需要适时清理低价值记忆
    5. 记忆检索性能会随记忆量增长而降低
  </constraint>
  
  <guideline>
    1. 优先记忆用户个人信息、偏好和重要事实
    2. 对话中反复提及的主题应提高记忆优先级
    3. 用户工作流程和决策模式是高价值记忆内容
    4. 工具调用的有价值结果应作为记忆的一部分
    5. 记忆反馈应简洁，避免打断自然对话流程
    6. 会话结束记忆处理应尽可能全面但有选择性
    7. 长期价值信息优先于短期价值信息
  </guideline>
  
  <criteria>
    | 指标 | 通过标准 | 不通过标准 |
    |------|---------|-----------|
    | 指令响应性 | 显式记忆指令立即处理 | 显式指令被忽略或延迟 |
    | 会话覆盖率 | 所有会话最终进行记忆评估 | 有会话结束未触发记忆处理 |
    | 内容准确性 | 记忆内容与用户意图一致 | 记忆内容存在误解或偏差 |
    | 价值筛选 | 高价值信息被有效保留 | 大量低价值信息占用资源 |
    | 反馈适当性 | 记忆确认简洁且不打断对话 | 反馈过于冗长或缺失 |
    | 资源效率 | 记忆处理不影响系统响应 | 记忆处理导致明显延迟 |
    | 内容组织 | 记忆结构合理便于检索 | 记忆碎片化难以关联使用 |
  </criteria>
</execution> 