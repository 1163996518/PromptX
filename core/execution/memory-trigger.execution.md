<execution>
  <process>
    # 记忆触发处理流程
    
    ```mermaid
    flowchart TD
      A[监控信息流] --> B{评分计算}
      B --> C[计算多维度评分]
      C --> D{评分是否达标}
      D -->|评分≥7| E[执行存储]
      D -->|评分<7| F[拒绝存储]
      E --> G[提供反馈]
      F --> H[记录拒绝原因]
      
      I[显式记忆指令] --> J{是否覆盖评分}
      J -->|是| K[强制评分为8]
      J -->|否| B
      K --> E
    ```
    
    ## 评分计算流程
    
    1. **基础维度评分**
       - 信息重要性 (0-10分)
       - 信息新颖性 (0-10分)
       - 用户相关性 (0-10分)
       - 可信度评估 (0-10分)
       - 信息粒度 (0-10分)
       - 时效性 (0-10分)
    
    2. **加权计算**
       ```
       总分 = (重要性×0.3 + 新颖性×0.1 + 相关性×0.2 + 
              可信度×0.2 + 粒度×0.1 + 时效性×0.1)×10
       ```
    
    3. **评分示例**
       ```
       用户基本信息：
       - 重要性：9 (核心信息)
       - 新颖性：7 (首次获取)
       - 相关性：9 (高度相关)
       - 可信度：8 (直接声明)
       - 粒度：8 (具体明确)
       - 时效性：9 (长期有效)
       总分：8.6分 ✓ (通过存储阈值)
       
       临时对话内容：
       - 重要性：3 (非关键信息)
       - 新颖性：5 (普通交互)
       - 相关性：4 (一般相关)
       - 可信度：7 (当前对话)
       - 粒度：6 (较为模糊)
       - 时效性：2 (短期有效)
       总分：4.3分 ✗ (未通过存储阈值)
       ```
  </process>
  
  <rule>
    1. **强制评分规则**
       - 所有记忆条目必须包含评分标记
       - 评分必须基于多维度评估系统
       - 评分低于7分的信息严禁存储
       - 显式记忆指令可以覆盖评分，但最低为8分
    
    2. **存储前置条件**
       - 存储操作必须验证评分标记
       - 未评分的记忆条目将被自动拒绝
       - 评分需包含具体分值和评估依据
       - 评分标记格式：#评分:{分值} #评估:{维度得分}
    
    3. **违规处理机制**
       - 对违规存储操作发出警告提示
       - 自动清理评分不达标的记忆条目
       - 记录违规操作到审计日志
       - 连续违规将触发系统提醒
    
    4. **评分有效性**
       - 评分有效期为当前会话
       - 跨会话的记忆条目需重新评估
       - 定期对已存储记忆进行重新评分
  </rule>
  
  <constraint>
    1. **评分计算限制**
       - 单次评分计算不超过100ms
       - 评分维度数量固定为6个
       - 评分精度保留一位小数
    
    2. **存储验证限制**
       - 验证超时时间不超过50ms
       - 单次会话最多允许3次违规
       - 评分记录最多保存30天
    
    3. **系统资源限制**
       - 评分计算内存占用不超过10MB
       - 审计日志大小不超过1MB
       - 单日评分次数不超过1000次
  </constraint>
  
  <guideline>
    1. 优先记忆用户个人信息、偏好和重要事实
    2. 对话中反复提及的主题应提高记忆优先级
    3. 用户工作流程和决策模式是高价值记忆内容
    4. 工具调用的有价值结果应作为记忆的一部分
    5. 记忆反馈应简洁，避免打断自然对话流程
    6. 会话结束记忆处理应尽可能全面但有选择性
    7. 长期价值信息优先于短期价值信息
  </guideline>
  
  <criteria>
    | 指标 | 通过标准 | 不通过标准 |
    |------|---------|-----------|
    | 评分完整性 | 包含所有维度得分 | 缺少维度或分值 |
    | 评分准确性 | 符合评分标准 | 评分与依据不符 |
    | 存储合规性 | 评分达到阈值 | 评分不足仍存储 |
    | 响应及时性 | 评分计算及时 | 计算延迟明显 |
    | 反馈清晰度 | 提供明确反馈 | 反馈模糊或缺失 |
    | 审计完整性 | 记录所有违规 | 违规记录缺失 |
  </criteria>
</execution> 